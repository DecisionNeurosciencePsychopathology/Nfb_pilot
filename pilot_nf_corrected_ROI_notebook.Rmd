---
title: "R Notebook"
output:
  html_document: default
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

``` {r load_libraries, message=F, warning=F}
library(nlme)
library(xtable)
library(lme4)
library(readr)
library(ggplot2)
library(lsmeans)
library(car)
```


```{r import_data}

# Import data
df <- read_csv("~/Google Drive/skinner/Pecina_k/alex_behav_full_merge_with_PEbetas.csv")

# recode, rename ROIs
# df <- read_csv("~/Google Drive/skinner/Pecina_k/alex_behav_full_merge_with_betas.csv")
df$Sex <- as.factor(df$Sex)
df$subject<- as.factor(df$subject)
# rename ROIs
df$new_L_postcentr_1 <-  df$PEmag_left_postcentral
df$new_visual_2 <- df$PEmag_visual
df$new_acc_3 <- df$PEmag_ant_cingulate
df$new_R_postcentr_4 <- df$PEmag_right_postcentral
df$new_striatum_5 <- df$PEmag_ventral_striatum
df$new_cereb1_6 <- df$PEmag_right_cullmen
df$new_cereb2_7 <- df$PEmag_cerebellum

# sanity check for ROIs
ggplot(data = df, mapping = aes(df$new_striatum_5, df$new_acc_3)) +geom_point(mapping = aes(df$new_striatum_5, df$new_acc_3))

```

``` {r feedback}
# nm1 <- (lmer(feedback_rating ~ stim_rating + feedback + feedback_ratinglag + (1 +feedback + stim_rating |subject), df))
# summary(nm1)
# car::Anova(nm1)


nm2 <- (lmer(feedback_rating ~ stim_rating*stim + feedback + feedback_ratinglag + (1 +feedback + stim_rating |subject), df))
summary(nm2)
car::Anova(nm2)
# anova(nm1,nm2)

ls_nm2 <- lsmeans(nm2,"stim_rating",by = "stim", at = list(stim_rating = c(-2,-1,0,1,2)))
plot(ls_nm2, type ~ stim_rating, horiz=F, ylab = "Mood ratings", xlab = "Expectancy")

nm3 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + new_visual_2*stim + (1 +feedback + stim_rating |subject), df))
summary(nm3)
car::Anova(nm3)

nm4 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + new_L_postcentr_1*stim + (1 +feedback + stim_rating |subject), df))
summary(nm4)
car::Anova(nm4)
anova(nm3,nm4)

nm5 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + new_striatum_5*stim + (1 +feedback + stim_rating |subject), df))
summary(nm5)
car::Anova(nm5)
anova(nm4,nm5)

ls_nm5 <- lsmeans(nm5,"stim",by = "new_striatum_5", at = list(new_striatum_5 = c(1,5,10)))
setwd("/Users/localadmin/Google Drive/skinner/Pecina_k/results/")
# pdf("str_modulation.pdf", width=5, height=3.5)
plot(ls_nm5, type ~ stim, horiz=F, ylab = "Mood ratings", xlab = "infusion", main = "Striatal activity modulates effect of infusion")

``` 

``` {r expectancy}
em1<- (lmer(stim_rating ~ stim + feedback_ratinglag*new_striatum_5  + (1 +stim  |subject), df))
summary(em1)
car::Anova(em1)

em2<- (lmer(stim_rating ~ stim + feedback_ratinglag*new_striatum_5 + stim_diff  + (1 +stim  |subject), df))
summary(em2)
car::Anova(em2)

ls_em2 <- lsmeans(em2,"feedback_ratinglag",by = "new_striatum_5", at = list(new_striatum_5 = c(1,5,10),feedback_ratinglag = c(-2,0,2)))
# pdf("str_modulation_feedback_rating_lag.pdf", width=5, height=3.5)
plot(ls_em2, type ~ stim, horiz=F, ylab = "Expectancy ratings", xlab = "Previous mood ratings", main = "Striatal activity modulates effect of earlier mood")
# dev.off()

# include indiv. differences in feedback rating models

# rescale
numcols <- grep("^c\\.",names(df))

# df$apathy <- scale(df$ApathyEvaluationScale)

im1 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + (1 +feedback + stim_rating |subject), df))
summary(im1)
car::Anova(im1)

im2 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + df$DAS7*feedback + (1 +feedback + stim_rating |subject), df))
summary(im2)
car::Anova(im2)
# anova(im1,im2)


# im3 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + df$YearsOfEd*feedback*stim + (1 +feedback + stim_rating |subject), df))
# summary(im3)
# car::Anova(im3)
# anova(im1,im3)
# ls_im3 <- lsmeans(im3,"stim",by = "df$YearsOfEd", at = list(df$YearsOfEd = c(8,13,18)))

#ls_nm2 <- lsmeans(nm2,"stim_rating",by = "stim", at = list(stim_rating = c(-2,-1,0,1,2)))
plot(ls_nm2, type ~ stim_rating, horiz=F, ylab = "Mood ratings", xlab = "Expectancy")


# im4 <- (lmer(feedback_rating ~ stim_rating*stim + feedback +feedback_ratinglag + df$new_striatum_5*stim + df$YearsOfEd*stim + (1 +feedback + stim_rating |subject), df))
# summary(im4)
# car::Anova(im4)
# anova(im3,im4)

ls_nm5 <- lsmeans(nm5,"stim",by = "new_striatum_5", at = list(new_striatum_5 = c(1,5,10)))

```


<!-- ``` {r check_apathy} -->
<!-- ggplot(data = df, mapping = aes(df$ApathyEvaluationScale,df$subject)) +geom_point(mapping = aes(df$ApathyEvaluationScale,df$subject)) -->

<!-- ggplot(data = df, mapping = aes(df$ApathyEvaluationScale,df$Age)) +geom_point(mapping = aes(df$ApathyEvaluationScale,df$Age)) -->
<!-- ``` -->


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
